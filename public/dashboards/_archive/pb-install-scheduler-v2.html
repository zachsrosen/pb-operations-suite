<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Photon Brothers Install Scheduler - RTB and Construction project scheduling">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>PB Install Scheduler | Photon Brothers</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --surface-hover: #1a1a24;
  --border: #1e1e2e;
  --text: #e4e4e7;
  --text-dim: #71717a;
  --accent: #f97316;
  --rtb: #10b981;
  --rtb-blocked: #eab308;
  --construction: #3b82f6;
  --solar: #06b6d4;
  --battery: #8b5cf6;
  --ev: #ec4899;
  --electrical: #f43f5e;
}
body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

/* Layout */
.app { display: grid; grid-template-columns: 380px 1fr; height: 100vh; }
.sidebar { background: var(--surface); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
.main { display: flex; flex-direction: column; overflow: hidden; }

/* Header */
header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); background: var(--surface); }
h1 { font-size: 1.3rem; font-weight: 700; background: linear-gradient(135deg, var(--accent), #fb923c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.25rem; }
.subtitle { font-size: 0.7rem; color: var(--text-dim); }

/* Location Tabs */
.location-tabs { display: flex; gap: 2px; padding: 0.5rem 0.75rem; background: var(--bg); border-bottom: 1px solid var(--border); overflow-x: auto; }
.location-tab { padding: 0.4rem 0.6rem; font-size: 0.7rem; font-weight: 500; border-radius: 6px; cursor: pointer; background: var(--surface); border: 1px solid var(--border); color: var(--text-dim); transition: all 0.15s; white-space: nowrap; }
.location-tab:hover { border-color: var(--text-dim); }
.location-tab.active { border-color: var(--accent); color: var(--accent); background: rgba(249, 115, 22, 0.1); }
.location-tab .count { font-family: 'JetBrains Mono', monospace; margin-left: 0.25rem; opacity: 0.7; }
.location-tab .revenue { font-size: 0.6rem; opacity: 0.6; display: block; }

/* Stats bar */
.stats-bar { display: flex; gap: 0.4rem; padding: 0.5rem 0.75rem; background: var(--bg); border-bottom: 1px solid var(--border); flex-wrap: wrap; }
.stat { display: flex; align-items: center; gap: 0.3rem; padding: 0.3rem 0.5rem; background: var(--surface); border-radius: 6px; border: 1px solid var(--border); }
.stat-dot { width: 8px; height: 8px; border-radius: 2px; }
.stat-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; font-size: 0.85rem; }
.stat-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; }

/* Crew Panel */
.crew-panel { padding: 0.75rem; background: var(--surface); border-bottom: 1px solid var(--border); }
.crew-panel h3 { font-size: 0.75rem; font-weight: 600; margin-bottom: 0.5rem; color: var(--text-dim); display: flex; align-items: center; gap: 0.5rem; }
.crew-grid { display: grid; gap: 0.4rem; }
.crew-card { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 0.5rem 0.6rem; }
.crew-name { font-size: 0.75rem; font-weight: 600; margin-bottom: 0.25rem; }
.crew-members { display: flex; gap: 0.4rem; flex-wrap: wrap; }
.crew-member { font-size: 0.6rem; padding: 2px 5px; border-radius: 3px; background: var(--border); }
.crew-member.roofer { background: rgba(16, 185, 129, 0.2); color: var(--rtb); }
.crew-member.electrician { background: rgba(139, 92, 246, 0.2); color: var(--battery); }

/* Sidebar Queue */
.queue-header { padding: 0.75rem; border-bottom: 1px solid var(--border); }
.queue-header h2 { font-size: 0.8rem; font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
.stage-tabs { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 0.5rem; }
.stage-tab { padding: 0.3rem 0.5rem; font-size: 0.65rem; border-radius: 4px; cursor: pointer; background: var(--bg); border: 1px solid var(--border); color: var(--text-dim); transition: all 0.15s; }
.stage-tab:hover { border-color: var(--text-dim); }
.stage-tab.active { border-color: var(--accent); color: var(--accent); background: rgba(249, 115, 22, 0.1); }
.stage-tab.rtb.active { border-color: var(--rtb); color: var(--rtb); background: rgba(16, 185, 129, 0.1); }
.stage-tab.blocked.active { border-color: var(--rtb-blocked); color: var(--rtb-blocked); background: rgba(234, 179, 8, 0.1); }
.stage-tab.construction.active { border-color: var(--construction); color: var(--construction); background: rgba(59, 130, 246, 0.1); }

.queue-filters { display: flex; flex-direction: column; gap: 0.4rem; }
.queue-filters input, .queue-filters select { width: 100%; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 0.35rem 0.5rem; border-radius: 6px; font-family: inherit; font-size: 0.7rem; }
.queue-filters input:focus, .queue-filters select:focus { outline: none; border-color: var(--accent); }

.queue-count { font-size: 0.7rem; color: var(--text-dim); padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border); background: var(--bg); }
.queue-list { flex: 1; overflow-y: auto; padding: 0.5rem; }

.queue-item { background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: 0.6rem; margin-bottom: 0.4rem; cursor: pointer; transition: all 0.15s; }
.queue-item:hover { border-color: var(--accent); transform: translateX(2px); }
.queue-item.selected { border-color: var(--accent); background: rgba(249, 115, 22, 0.1); box-shadow: 0 0 0 1px var(--accent); }
.queue-item.rtb { border-left: 3px solid var(--rtb); }
.queue-item.blocked { border-left: 3px solid var(--rtb-blocked); }
.queue-item.construction { border-left: 3px solid var(--construction); }
.queue-item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.25rem; }
.queue-item-name { font-size: 0.75rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
.queue-item-amount { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: var(--accent); font-weight: 600; }
.queue-item-address { font-size: 0.65rem; color: var(--text-dim); margin-bottom: 0.3rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.queue-item-meta { display: flex; gap: 0.3rem; flex-wrap: wrap; align-items: center; }
.queue-item-tag { font-size: 0.55rem; padding: 2px 4px; border-radius: 3px; background: var(--border); color: var(--text-dim); }
.queue-item-tag.solar { background: rgba(6, 182, 212, 0.2); color: var(--solar); }
.queue-item-tag.battery { background: rgba(139, 92, 246, 0.2); color: var(--battery); }
.queue-item-tag.ev { background: rgba(236, 72, 153, 0.2); color: var(--ev); }
.queue-item-tag.electrical { background: rgba(244, 63, 94, 0.2); color: var(--electrical); }
.queue-item-tag.rtb { background: rgba(16, 185, 129, 0.2); color: var(--rtb); }
.queue-item-tag.blocked { background: rgba(234, 179, 8, 0.2); color: var(--rtb-blocked); }
.queue-item-tag.construction { background: rgba(59, 130, 246, 0.2); color: var(--construction); }
.queue-item-tag.scheduled-date { background: rgba(59, 130, 246, 0.3); color: var(--construction); font-weight: 600; }

/* Equipment specs */
.queue-item-specs { display: flex; gap: 0.5rem; margin-top: 0.3rem; flex-wrap: wrap; }
.spec { font-size: 0.6rem; color: var(--text-dim); }
.spec strong { color: var(--text); }

/* Calendar area */
.calendar-container { flex: 1; padding: 0.75rem; overflow-y: auto; }
.month-nav { display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 0.5rem; }
.month-nav button { background: var(--surface); border: 1px solid var(--border); color: var(--text); padding: 0.35rem 0.7rem; border-radius: 6px; cursor: pointer; font-family: inherit; font-size: 0.75rem; transition: all 0.15s; }
.month-nav button:hover { background: var(--border); }
.month-title { font-size: 1rem; font-weight: 600; min-width: 150px; text-align: center; }

.legend { display: flex; gap: 1rem; justify-content: center; margin-bottom: 0.5rem; flex-wrap: wrap; }
.legend-item { display: flex; align-items: center; gap: 0.3rem; font-size: 0.65rem; color: var(--text-dim); }
.legend-dot { width: 8px; height: 8px; border-radius: 2px; }

.calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: var(--border); border-radius: 10px; overflow: hidden; padding: 2px; }
.day-header { background: var(--surface); padding: 0.4rem; text-align: center; font-weight: 600; font-size: 0.65rem; color: var(--text-dim); }
.day { background: var(--surface); min-height: 85px; padding: 0.3rem; position: relative; cursor: pointer; transition: all 0.15s; }
.day:hover { background: var(--surface-hover); }
.day.other-month { opacity: 0.4; }
.day.today { box-shadow: inset 0 0 0 2px var(--accent); }
.day.drop-target { background: rgba(249, 115, 22, 0.15); box-shadow: inset 0 0 0 2px var(--accent); }
.day-number { font-size: 0.7rem; font-weight: 600; margin-bottom: 0.2rem; color: var(--text-dim); }
.day.today .day-number { color: var(--accent); }
.day.weekend { background: rgba(0,0,0,0.2); }

/* Events */
.event { font-size: 0.55rem; padding: 2px 3px; border-radius: 3px; margin-bottom: 2px; cursor: pointer; transition: transform 0.1s; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.event:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10; position: relative; }
.event.rtb { background: var(--rtb); color: #000; }
.event.blocked { background: var(--rtb-blocked); color: #000; }
.event.construction { background: var(--construction); color: #fff; }
.event.scheduled { background: var(--solar); color: #fff; }
.more-events { font-size: 0.55rem; color: var(--text-dim); text-align: center; padding: 2px; cursor: pointer; }

/* Instructions banner */
.instructions { background: rgba(249, 115, 22, 0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 0.5rem 0.75rem; margin-bottom: 0.5rem; display: none; }
.instructions.visible { display: block; }
.instructions-text { font-size: 0.7rem; color: var(--accent); }

/* Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
.modal-overlay.visible { display: flex; }
.modal { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.25rem; max-width: 500px; width: 90%; max-height: 85vh; overflow-y: auto; }
.modal h3 { font-size: 1rem; margin-bottom: 0.75rem; }
.modal-body { margin-bottom: 1rem; }
.modal-section { margin-bottom: 0.75rem; }
.modal-section-title { font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 0.3rem; font-weight: 600; }
.modal-row { display: flex; justify-content: space-between; padding: 0.3rem 0; border-bottom: 1px solid var(--border); font-size: 0.75rem; }
.modal-row:last-child { border-bottom: none; }
.modal-label { color: var(--text-dim); }
.modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; flex-wrap: wrap; }
.modal-btn { padding: 0.4rem 0.8rem; border-radius: 6px; font-family: inherit; font-size: 0.75rem; cursor: pointer; transition: all 0.15s; }
.modal-btn.cancel { background: var(--bg); border: 1px solid var(--border); color: var(--text); }
.modal-btn.cancel:hover { background: var(--border); }
.modal-btn.confirm { background: var(--accent); border: 1px solid var(--accent); color: #000; font-weight: 600; }
.modal-btn.confirm:hover { background: #ea580c; }
.modal-btn.hubspot { background: #ff7a59; border: 1px solid #ff7a59; color: #fff; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.3rem; }

/* Days input */
.days-input { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap; }
.days-input label { font-size: 0.7rem; color: var(--text-dim); }
.days-input input { width: 50px; background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 0.25rem 0.4rem; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; text-align: center; }
.days-input select { background: var(--bg); border: 1px solid var(--border); color: var(--text); padding: 0.25rem 0.4rem; border-radius: 4px; font-size: 0.7rem; }

/* Toast */
.toast { position: fixed; bottom: 1.5rem; right: 1.5rem; background: var(--rtb); color: #000; padding: 0.7rem 1rem; border-radius: 8px; font-size: 0.75rem; font-weight: 500; transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 1001; }
.toast.visible { transform: translateY(0); opacity: 1; }

/* Scrollbar */
::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }

/* Responsive */
@media (max-width: 1200px) {
  .app { grid-template-columns: 320px 1fr; }
}
@media (max-width: 900px) {
  .app { grid-template-columns: 1fr; }
  .sidebar { max-height: 50vh; }
}
</style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <header>
      <h1>‚ö° PB Install Scheduler</h1>
      <div class="subtitle">Live HubSpot Data ‚Ä¢ RTB + Construction ‚Ä¢ Updated Jan 14, 2026</div>
    </header>
    
    <!-- Crew Panel -->
    <div class="crew-panel" id="crewPanel">
      <h3>üë∑ Crew Capacity</h3>
      <div class="crew-grid" id="crewGrid"></div>
    </div>
    
    <div class="queue-header">
      <h2>üìã Install Pipeline</h2>
      <div class="stage-tabs" id="stageTabs"></div>
      <div class="queue-filters">
        <input type="text" id="searchInput" placeholder="Search projects...">
        <select id="typeFilter">
          <option value="">All Types</option>
          <option value="Solar">Solar</option>
          <option value="Battery">Battery</option>
          <option value="EV">EV Charger</option>
          <option value="Electrical">Electrical</option>
        </select>
      </div>
    </div>
    
    <div class="queue-count" id="queueCount">0 projects</div>
    <div class="queue-list" id="queueList"></div>
  </aside>

  <!-- Main: Calendar -->
  <main class="main">
    <!-- Location Tabs -->
    <div class="location-tabs" id="locationTabs"></div>
    
    <div class="stats-bar" id="statsBar"></div>
    
    <div class="calendar-container">
      <div class="instructions" id="instructions">
        <div class="instructions-text">üìÖ <strong id="selectedProjectName">Project</strong> selected ‚Äî click a day on the calendar to schedule install</div>
      </div>
      
      <div class="month-nav">
        <button onclick="prevMonth()">‚Üê Prev</button>
        <div class="month-title" id="monthTitle">January 2026</div>
        <button onclick="nextMonth()">Next ‚Üí</button>
      </div>
      
      <div class="legend" id="legend"></div>
      <div class="calendar" id="calendar"></div>
    </div>
  </main>
</div>

<!-- Schedule Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3>üìÖ Schedule Install</h3>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-actions">
      <button class="modal-btn cancel" onclick="closeModal()">Cancel</button>
      <button class="modal-btn confirm" onclick="confirmSchedule()">Schedule</button>
    </div>
  </div>
</div>

<!-- Project Detail Modal -->
<div class="modal-overlay" id="detailModal">
  <div class="modal">
    <h3>üìã Project Details</h3>
    <div class="modal-body" id="detailModalBody"></div>
    <div class="modal-actions">
      <a class="modal-btn hubspot" id="hubspotLink" href="#" target="_blank">Open in HubSpot ‚Üó</a>
      <button class="modal-btn cancel" onclick="closeDetailModal()">Close</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ===== LIVE HUBSPOT DATA - RTB, RTB-BLOCKED & CONSTRUCTION =====
const projects = [
  // ============ CONSTRUCTION STAGE (10 projects - already scheduled) ============
  { id: "32743168407", name: "PROJ-7634 | American Water Works", address: "6666 W Quincy Ave, Denver, CO", location: "Centennial", amount: 299500, type: "Solar", stage: "construction", systemSize: 114.81, batteries: 0, batteryModel: null, crew: null, daysInstall: 5, daysElec: 3, elecCount: 2, roofType: "Membrane EPDM", scheduleDate: "2025-10-27", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/32743168407" },
  { id: "13126218378", name: "PROJ-6839 | Whittier Place", address: "2301 Pearl St, Boulder, CO", location: "Westminster", amount: 87249, type: "Solar", stage: "construction", systemSize: 29.1, batteries: 0, batteryModel: null, crew: "WESTY Bravo", daysInstall: 3, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: "2026-01-05", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/13126218378" },
  { id: "18872830551", name: "PROJ-7075 | Miller J", address: "2315 S Monroe St, Denver, CO", location: "Centennial", amount: 72563, type: "Battery;EV Charger;Solar", stage: "construction", systemSize: 13.2, batteries: 2, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 3, daysElec: 2, elecCount: 2, roofType: "Membrane EPDM", scheduleDate: "2026-01-14", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/18872830551" },
  { id: "42073940556", name: "PROJ-8518 | Neal", address: "9111 E Lost Hill Trl, Lone Tree, CO", location: "Centennial", amount: 52247, type: "Battery;Electrical;Solar", stage: "construction", systemSize: 10.12, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: null, scheduleDate: "2026-01-20", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42073940556" },
  { id: "41084998526", name: "PROJ-8367 | Mitchell J", address: "7794 Dyer Rd, Louisville, CO", location: "Westminster", amount: 38424, type: "Battery;Solar", stage: "construction", systemSize: 8.17, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: "2026-01-16", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41084998526" },
  { id: "41148554057", name: "PROJ-8395 | Wu", address: "2449 Whitechapel Pl, Thousand Oaks, CA", location: "Camarillo", amount: 38209, type: "Battery;Solar", stage: "construction", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: "2026-01-15", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41148554057" },
  { id: "43170798722", name: "PROJ-8594 | SAGE", address: "4975 Dover Dr, Colorado Springs, CO", location: "Colorado Springs", amount: 35951, type: "Battery;Solar", stage: "construction", systemSize: 7.31, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: "2026-01-07", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43170798722" },
  { id: "29846655361", name: "PROJ-7298 | Eskelin", address: "3113 Rogers Dr, Cambria, CA", location: "San Luis Obispo", amount: 35592, type: "Battery;EV Charger;Solar", stage: "construction", systemSize: 3.7, batteries: 1, batteryModel: "PW3", crew: null, daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: "2025-12-22", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/29846655361" },
  { id: "48425963637", name: "PROJ-8812 | Ammon", address: "1722 Bee Canyon Rd, Arroyo Grande, CA", location: "San Luis Obispo", amount: 32124, type: "Battery", stage: "construction", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: "2026-01-15", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/48425963637" },
  { id: "43216836975", name: "PROJ-8654 | Lingle", address: "13825 Overlook Pl, Colorado Springs, CO", location: "Colorado Springs", amount: 28728, type: "Battery", stage: "construction", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 1, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: "2026-01-05", hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43216836975" },

  // ============ WESTMINSTER - RTB & RTB-BLOCKED ============
  { id: "23303209770", name: "PROJ-8048 | Huynh", address: "12649 Appaloosa Pl, Broomfield, CO", location: "Westminster", amount: 70000, type: "Solar;Battery", stage: "blocked", systemSize: 19.78, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/23303209770" },
  { id: "43125493794", name: "PROJ-8642 | Hart", address: "1234 Doris Cir, Erie, CO", location: "Westminster", amount: 63793, type: "Battery;Solar", stage: "blocked", systemSize: 14.19, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 3, daysElec: 2, elecCount: 2, roofType: "Metal Standing Seam", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43125493794" },
  { id: "43483187506", name: "PROJ-8702 | Schaub", address: "13942 Crestone Cir, Broomfield, CO", location: "Westminster", amount: 55292, type: "Battery;Solar", stage: "blocked", systemSize: 10.75, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43483187506" },
  { id: "41572636232", name: "PROJ-8554 | Strossner", address: "128 Rock Bridge Ct, Windsor, CO", location: "Westminster", amount: 50349, type: "Battery;Solar", stage: "blocked", systemSize: 13.2, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41572636232" },
  { id: "39049084790", name: "PROJ-8128 | Martin", address: "2940 18th St, Boulder, CO", location: "Westminster", amount: 49460, type: "Battery;Solar", stage: "rtb", systemSize: 8.6, batteries: 1, batteryModel: "PW3 AC", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/39049084790" },
  { id: "42400475772", name: "PROJ-8548 | Eide", address: "920 Home Farm Cir, Westminster, CO", location: "Westminster", amount: 46725, type: "Battery;Electrical;Solar", stage: "blocked", systemSize: 9.9, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 3, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42400475772" },
  { id: "42568336245", name: "PROJ-8489 | Hidalgo", address: "6689 Blazing Star Ct, Boulder, CO", location: "Westminster", amount: 39464, type: "Solar", stage: "rtb", systemSize: 13.86, batteries: 0, batteryModel: null, crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42568336245" },
  { id: "35676030801", name: "PROJ-8539 | Anderson", address: "1012 Honeysuckle Ln, Louisville, CO", location: "Westminster", amount: 38901, type: "Battery;Solar", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/35676030801" },
  { id: "41696679728", name: "PROJ-8500 | Berman", address: "699 Quince Circle, Boulder, CO", location: "Westminster", amount: 37417, type: "Battery;Solar", stage: "rtb", systemSize: 9.24, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41696679728" },
  { id: "20307498596", name: "PROJ-8182 | Hancz", address: "213 Deer Trail Cir, Boulder, CO", location: "Westminster", amount: 37388, type: "Battery;EV Charger;Solar", stage: "rtb", systemSize: 5.59, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/20307498596" },
  { id: "33719541677", name: "PROJ-7777 | Slater", address: "9700 Sugarloaf Rd, Boulder, CO", location: "Westminster", amount: 37195, type: "Battery;Solar", stage: "blocked", systemSize: 9.68, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/33719541677" },
  { id: "46825526853", name: "PROJ-8771 | Rassokhin", address: "8470 W 74th Dr, Arvada, CO", location: "Westminster", amount: 34258, type: "Solar", stage: "rtb", systemSize: 10.56, batteries: 0, batteryModel: null, crew: "WESTY Alpha", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/46825526853" },
  { id: "46427629876", name: "PROJ-8783 | Cantwell", address: "1516 Landon Ct, Windsor, CO", location: "Westminster", amount: 33845, type: "Battery;Solar", stage: "blocked", systemSize: 7.04, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/46427629876" },
  { id: "37165737473", name: "PROJ-8519 | Brinkmann", address: "475 Fillmore Ct, Louisville, CO", location: "Westminster", amount: 33146, type: "Battery;Solar", stage: "blocked", systemSize: 4.3, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/37165737473" },
  { id: "22337108294", name: "PROJ-8006 | Yan Zhang", address: "7 Benchmark Dr, Boulder, CO", location: "Westminster", amount: 32007, type: "Battery;Solar", stage: "rtb", systemSize: 6.88, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/22337108294" },
  { id: "29502687648", name: "PROJ-7353 | Frey", address: "390 Porter Ranch Rd, Nederland, CO", location: "Westminster", amount: 30872, type: "Battery;Solar", stage: "blocked", systemSize: 5.04, batteries: 1, batteryModel: "PW3", crew: "WESTY Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Membrane EPDM", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/29502687648" },
  { id: "34669853762", name: "PROJ-8521 | Alexander", address: "306 Biscayne Ct, Lafayette, CO", location: "Westminster", amount: 27425, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: 3.01, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/34669853762" },
  { id: "41600411820", name: "PROJ-8512 | Merrick", address: "2250 E Hecla Dr Unit B, Louisville, CO", location: "Westminster", amount: 20937, type: "Battery", stage: "blocked", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "WESTY Bravo", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41600411820" },
  { id: "41565088337", name: "PROJ-8636 | Draper", address: "10814 Brewer Dr, Northglenn, CO", location: "Westminster", amount: 17680, type: "Solar;Electrical", stage: "blocked", systemSize: 3.44, batteries: 0, batteryModel: null, crew: null, daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41565088337" },
  { id: "43067096885", name: "PROJ-8743 | Gantman", address: "2309 Watersong Cir, Longmont, CO", location: "Westminster", amount: 16744, type: "Solar", stage: "blocked", systemSize: 4.3, batteries: 0, batteryModel: null, crew: null, daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43067096885" },

  // ============ CENTENNIAL - RTB & RTB-BLOCKED ============
  { id: "16317765258", name: "PROJ-7035 | Arrow HQ", address: "9151 E Panorama Cir, Englewood, CO", location: "Centennial", amount: 887389, type: "Solar", stage: "blocked", systemSize: 221.1, batteries: 0, batteryModel: null, crew: null, daysInstall: 10, daysElec: 5, elecCount: 4, roofType: "Membrane EPDM", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/16317765258" },
  { id: "43487863931", name: "PROJ-8650 | Rosell", address: "933 Xenon Ct, Golden, CO", location: "Centennial", amount: 56203, type: "Battery;Solar", stage: "blocked", systemSize: 15.4, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43487863931" },
  { id: "34099222868", name: "PROJ-7760 | Morris", address: "3518 N Marion St, Denver, CO", location: "Centennial", amount: 42199, type: "Battery;Solar", stage: "blocked", systemSize: 10.32, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/34099222868" },
  { id: "41519729833", name: "PROJ-8677 | SHAY", address: "134 S Pontiac St, Denver, CO", location: "Centennial", amount: 41315, type: "Battery;Solar", stage: "blocked", systemSize: 9.89, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41519729833" },
  { id: "22369894033", name: "PROJ-7064 | Purcell", address: "720 Madison St, Denver, CO", location: "Centennial", amount: 39978, type: "Battery;Solar", stage: "blocked", systemSize: 8.5, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/22369894033" },
  { id: "43114949791", name: "PROJ-8629 | Hewitt", address: "15131 W Harvard Cir, Lakewood, CO", location: "Centennial", amount: 39801, type: "Battery;Solar", stage: "blocked", systemSize: 7.74, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Tile Concrete", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43114949791" },
  { id: "41453994615", name: "PROJ-8528 | Montoya", address: "672 S Carlton St, Castle Rock, CO", location: "Centennial", amount: 38480, type: "Battery;Solar", stage: "blocked", systemSize: 8.17, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41453994615" },
  { id: "40297686180", name: "PROJ-8295 | Tallerday", address: "139 Beethoven Dr, Black Hawk, CO", location: "Centennial", amount: 34455, type: "Solar", stage: "blocked", systemSize: 10.32, batteries: 0, batteryModel: null, crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Metal Standing Seam", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/40297686180" },
  { id: "12154128687", name: "PROJ-8618 | Miller T", address: "4145 Gray St, Wheat Ridge, CO", location: "Centennial", amount: 33839, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: 5.59, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/12154128687" },
  { id: "43784573251", name: "PROJ-8694 | Johnson", address: "11542 W Lake Dr, Littleton, CO", location: "Centennial", amount: 30825, type: "Battery;Electrical;Solar", stage: "blocked", systemSize: 5.16, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43784573251" },
  { id: "42497083061", name: "PROJ-8611 | Spears", address: "718 Willow Brook Rd, Silverthorne, CO", location: "Centennial", amount: 29328, type: "Battery", stage: "blocked", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 1, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42497083061" },
  { id: "41110252359", name: "PROJ-8409 | Parker", address: "7400 W Grant Ranch Blvd, Littleton, CO", location: "Centennial", amount: 25851, type: "Battery;Electrical", stage: "blocked", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41110252359" },
  { id: "42048118141", name: "PROJ-8724 | Weyerman", address: "19955 E Lehigh Pl, Aurora, CO", location: "Centennial", amount: 18291, type: "Battery", stage: "blocked", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "DTC Alpha", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42048118141" },
  { id: "42725891186", name: "PROJ-8535 | Amery", address: "1100 Milwaukee St, Denver, CO", location: "Centennial", amount: 18291, type: "Battery", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "DTC Bravo", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42725891186" },
  { id: "37193780921", name: "PROJ-8415 | Dhillon", address: "24488 E Adriatic Dr, Aurora, CO", location: "Centennial", amount: 16102, type: "Solar", stage: "blocked", systemSize: 4.73, batteries: 0, batteryModel: null, crew: "DTC Alpha", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Other", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/37193780921" },
  { id: "45080982280", name: "PROJ-8764 | Jones", address: "6510 Leathers Ln, Parker, CO", location: "Centennial", amount: 14067, type: "Solar", stage: "blocked", systemSize: 6.02, batteries: 0, batteryModel: null, crew: "DTC Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/45080982280" },

  // ============ COLORADO SPRINGS - RTB & RTB-BLOCKED ============
  { id: "42242445906", name: "PROJ-8524 | Binkowski", address: "15905 Cala Rojo Dr, Colorado Springs, CO", location: "Colorado Springs", amount: 52252, type: "Battery;Solar", stage: "blocked", systemSize: 9.89, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42242445906" },
  { id: "46046855252", name: "PROJ-8794 | Selig", address: "1405 Laurette Dr, Colorado Springs, CO", location: "Colorado Springs", amount: 39175, type: "Battery;Solar", stage: "blocked", systemSize: 9.24, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/46046855252" },
  { id: "38568935058", name: "PROJ-8194 | Clement", address: "708 Sahwatch St, Colorado Springs, CO", location: "Colorado Springs", amount: 33837, type: "Battery;Solar", stage: "blocked", systemSize: 6.88, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/38568935058" },
  { id: "45151434504", name: "PROJ-8723 | Baker", address: "12460 Woodruff Dr, Colorado Springs, CO", location: "Colorado Springs", amount: 33490, type: "Battery;Solar", stage: "blocked", systemSize: 4.4, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Tile Concrete", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/45151434504" },
  { id: "40892008480", name: "PROJ-8660 | Seidle", address: "2779 River Dr, Alma, CO", location: "Colorado Springs", amount: 30059, type: "Battery;Solar", stage: "blocked", systemSize: 3.87, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Metal Standing Seam", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/40892008480" },
  { id: "40983782672", name: "PROJ-8381 | Gaalema", address: "12930 Morris Trail, Colorado Springs, CO", location: "Colorado Springs", amount: 27403, type: "Battery;Solar", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "COSP Alpha", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/40983782672" },
  { id: "46048497773", name: "PROJ-8778 | Rees", address: "18470 Academy Cir, Monument, CO", location: "Colorado Springs", amount: 26838, type: "Solar", stage: "blocked", systemSize: 8.36, batteries: 0, batteryModel: null, crew: "COSP Alpha", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/46048497773" },

  // ============ SAN LUIS OBISPO - RTB & RTB-BLOCKED ============
  { id: "16490701650", name: "PROJ-6351 | Bread Bike", address: "2060 Parker St, San Luis Obispo, CA", location: "San Luis Obispo", amount: 60000, type: "Solar", stage: "blocked", systemSize: 19, batteries: 0, batteryModel: null, crew: null, daysInstall: 3, daysElec: 2, elecCount: 2, roofType: "Membrane EPDM", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/16490701650" },
  { id: "35668319596", name: "PROJ-8026 | Flores", address: "6475 Mira Cielo, San Luis Obispo, CA", location: "San Luis Obispo", amount: 55000, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Ground Mount", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/35668319596" },
  { id: "39217639532", name: "PROJ-8217 | Violetti", address: "2222 Richview Rd, Santa Maria, CA", location: "San Luis Obispo", amount: 52019, type: "Battery;Solar", stage: "blocked", systemSize: 13.7, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 2", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Ground Mount", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/39217639532" },
  { id: "33823251811", name: "PROJ-7729 | Benson", address: "5385 Rancho La Loma Linda Dr, Paso Robles, CA", location: "San Luis Obispo", amount: 43622, type: "Battery;Solar;Add-On", stage: "blocked", systemSize: 3.87, batteries: 1, batteryModel: "PW3", crew: "SLO Solar", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Ground Mount", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/33823251811" },
  { id: "42265220259", name: "PROJ-8540 | Norholm", address: "301 Fair Oaks Ave, Arroyo Grande, CA", location: "San Luis Obispo", amount: 42772, type: "Battery;EV Charger;Solar", stage: "rtb", systemSize: 9, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42265220259" },
  { id: "37116101470", name: "PROJ-7963 | Jerkovich", address: "2460 Laurel Ave, Morro Bay, CA", location: "San Luis Obispo", amount: 38994, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 2", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/37116101470" },
  { id: "43562208539", name: "PROJ-8634 | Bryan", address: "4691 Tepusquet Rd, Santa Maria, CA", location: "San Luis Obispo", amount: 37680, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: 5.6, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43562208539" },
  { id: "38524620936", name: "PROJ-8162 | Clayton", address: "1548 Strand Way, Oceano, CA", location: "San Luis Obispo", amount: 37147, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: 8.6, batteries: 1, batteryModel: "PW3", crew: "SLO Solar", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Tile Concrete", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/38524620936" },
  { id: "41434163825", name: "PROJ-8596 | Eckert", address: "3680 Oakdale Rd, Paso Robles, CA", location: "San Luis Obispo", amount: 36274, type: "Battery;EV Charger", stage: "rtb", systemSize: 0, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41434163825" },
  { id: "35133791026", name: "PROJ-7932 | Norholm P", address: "5001 Lopez Dr, Arroyo Grande, CA", location: "San Luis Obispo", amount: 35200, type: "Battery;EV Charger;Solar", stage: "blocked", systemSize: 5.16, batteries: 1, batteryModel: "PW3", crew: "SLO Solar", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/35133791026" },
  { id: "28860087969", name: "PROJ-7370 | Pelisek", address: "1620 Geneseo Rd, Paso Robles, CA", location: "San Luis Obispo", amount: 32950, type: "Battery;EV Charger", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 2", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/28860087969" },
  { id: "19495669155", name: "PROJ-7945 | Sahagun", address: "4435 Holly St, Guadalupe, CA", location: "San Luis Obispo", amount: 28400, type: "Battery;EV Charger;Solar", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3 AC", crew: "SLO Solar", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/19495669155" },
  { id: "42969550992", name: "PROJ-8632 | Johnston", address: "Santa Fe 2nd NW of Ocean Ave, Carmel, CA", location: "San Luis Obispo", amount: 26619, type: "Battery;EV Charger;Solar", stage: "rtb", systemSize: 2.15, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 2", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42969550992" },
  { id: "28809813653", name: "PROJ-8762 | Ellis", address: "11295 Los Osos Valley Rd #27, San Luis Obispo, CA", location: "San Luis Obispo", amount: 25971, type: "Battery;Solar", stage: "rtb", systemSize: 5.6, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 2", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/28809813653" },
  { id: "49728894116", name: "PROJ-8846 | Lau", address: "6325 Mira Cielo, San Luis Obispo, CA", location: "San Luis Obispo", amount: 23800, type: "Battery", stage: "rtb", systemSize: 1.6, batteries: 1, batteryModel: "PW2", crew: null, daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "S-Tile", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/49728894116" },
  { id: "28462208159", name: "PROJ-7292 | Smith R", address: "34979 Sky Ranch Rd, Carmel Valley, CA", location: "San Luis Obispo", amount: 21070, type: "Battery", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "SLO Electrical 1", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/28462208159" },
  { id: "23041358644", name: "PROJ-7367 | Chatham", address: "1055 Tishlini Ln, Templeton, CA", location: "San Luis Obispo", amount: 12334, type: "Solar", stage: "blocked", systemSize: 3.36, batteries: 0, batteryModel: null, crew: "SLO Solar", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not Set", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/23041358644" },
  { id: "36741931101", name: "PROJ-7981 | Aguilar", address: "351 Panay St, Morro Bay, CA", location: "San Luis Obispo", amount: 12043, type: "Solar", stage: "rtb", systemSize: null, batteries: 0, batteryModel: null, crew: "SLO Electrical 2", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Membrane TPO", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/36741931101" },

  // ============ CAMARILLO - RTB & RTB-BLOCKED ============
  { id: "38866623353", name: "PROJ-8091 | Rakoski", address: "20120 Wells Dr, Woodland Hills, CA", location: "Camarillo", amount: 63745, type: "Solar;Battery", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/38866623353" },
  { id: "43878057266", name: "PROJ-8656 | L Tansey", address: "2771 Acacia St, Camarillo, CA", location: "Camarillo", amount: 62941, type: "Battery;Electrical;Solar", stage: "blocked", systemSize: 10.75, batteries: 2, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43878057266" },
  { id: "43817717324", name: "PROJ-8683 | Richards", address: "645 Skyline Rd, Ventura, CA", location: "Camarillo", amount: 55768, type: "Battery;Solar", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Flat Roof", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43817717324" },
  { id: "45369375558", name: "PROJ-8730 | Diep", address: "2277 El Nido Ct, Camarillo, CA", location: "Camarillo", amount: 42966, type: "Battery;Solar", stage: "rtb", systemSize: null, batteries: 2, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Tile Concrete", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/45369375558" },
  { id: "41564768293", name: "PROJ-8472 | Heiting", address: "32000 Watergate Ct, Westlake Village, CA", location: "Camarillo", amount: 30478, type: "Battery", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41564768293" },
  { id: "34882423666", name: "PROJ-7756 | Wells", address: "24520 Dry Canyon Cold Creek Rd, Calabasas, CA", location: "Camarillo", amount: 30325, type: "Battery;EV Charger", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3 AC", crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/34882423666" },
  { id: "42755755408", name: "PROJ-8609 | Case", address: "367 Nueve Ct, Camarillo, CA", location: "Camarillo", amount: 29944, type: "Battery;Solar", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/42755755408" },
  { id: "45934137926", name: "PROJ-8749 | Casselman", address: "27002 Malibu Cove Colony Dr, Malibu, CA", location: "Camarillo", amount: 29431, type: "Battery", stage: "rtb", systemSize: null, batteries: 2, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 1, daysElec: 2, elecCount: 2, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/45934137926" },
  { id: "31417985172", name: "PROJ-7428 | Alonzo", address: "172 Maple Rd, Thousand Oaks, CA", location: "Camarillo", amount: 22250, type: "Battery;Solar", stage: "blocked", systemSize: null, batteries: 1, batteryModel: "PW3 AC", crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/31417985172" },
  { id: "43946261506", name: "PROJ-8697 | Castillo", address: "1878 Hobart Dr, Camarillo, CA", location: "Camarillo", amount: 18204, type: "Battery", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/43946261506" },
  { id: "48475133869", name: "PROJ-8810 | Rahane", address: "194 Rose St, Fillmore, CA", location: "Camarillo", amount: 17768, type: "Battery", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW3", crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/48475133869" },
  { id: "49134683809", name: "PROJ-8832 | Harris", address: "669 Larchmont St, Simi Valley, CA", location: "Camarillo", amount: 13199, type: "Battery", stage: "rtb", systemSize: null, batteries: 0, batteryModel: null, crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: "Not A Solar Job", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/49134683809" },
  { id: "40715624614", name: "PROJ-8320 | Knapp", address: "349 Ridgecrest Dr, Santa Barbara, CA", location: "Camarillo", amount: 10227, type: "Solar;Roofing", stage: "blocked", systemSize: 2.15, batteries: 0, batteryModel: null, crew: "Camarillo Crew", daysInstall: 2, daysElec: 1, elecCount: 1, roofType: "Composition Shingle", scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/40715624614" },
  { id: "41511499107", name: "PROJ-8466 | Patel", address: "3187 Calle De Debesa, Camarillo, CA", location: "Camarillo", amount: 5600, type: "Battery", stage: "rtb", systemSize: null, batteries: 1, batteryModel: "PW+", crew: "Camarillo Crew", daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/41511499107" },
  { id: "50909782639", name: "PROJ-8943 | Duross", address: "1823 Mira Vista, Santa Barbara, CA", location: "Camarillo", amount: 2750, type: null, stage: "rtb", systemSize: null, batteries: 0, batteryModel: null, crew: null, daysInstall: 1, daysElec: 1, elecCount: 1, roofType: null, scheduleDate: null, hubspotUrl: "https://app.hubspot.com/contacts/21710069/record/0-3/50909782639" },
];

// ===== CREW CONFIGURATION =====
const crews = {
  "Westminster": [
    { name: "WESTY Alpha", roofers: 2, electricians: 1 },
    { name: "WESTY Bravo", roofers: 2, electricians: 1 }
  ],
  "Centennial": [
    { name: "DTC Alpha", roofers: 2, electricians: 1 },
    { name: "DTC Bravo", roofers: 2, electricians: 1 }
  ],
  "Colorado Springs": [
    { name: "COSP Alpha", roofers: 3, electricians: 1 }
  ],
  "San Luis Obispo": [
    { name: "SLO Solar", roofers: 2, electricians: 1 },
    { name: "SLO Electrical 1", roofers: 0, electricians: 2 },
    { name: "SLO Electrical 2", roofers: 0, electricians: 2 }
  ],
  "Camarillo": [
    { name: "Camarillo Crew", roofers: 2, electricians: 1 }
  ]
};

const locations = ['All', 'Westminster', 'Centennial', 'Colorado Springs', 'San Luis Obispo', 'Camarillo'];

// State
let currentYear = 2026, currentMonth = 0;
let selectedProject = null;
let selectedStage = 'all';
let selectedLocation = 'All';
let manualSchedules = {}; // { projectId: { startDate, days, crew } }

const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

// Initialize
function init() {
  renderLocationTabs();
  renderStageTabs();
  renderCrewPanel();
  renderStats();
  renderLegend();
  renderQueue();
  renderCalendar();
}

function renderLocationTabs() {
  const container = document.getElementById('locationTabs');
  container.innerHTML = locations.map(loc => {
    const locProjects = loc === 'All' ? projects : projects.filter(p => p.location === loc);
    const count = locProjects.length;
    const revenue = (locProjects.reduce((sum, p) => sum + p.amount, 0) / 1000).toFixed(0);
    return `<div class="location-tab ${selectedLocation === loc ? 'active' : ''}" onclick="selectLocation('${loc}')">
      ${loc === 'All' ? 'üåê All' : loc} <span class="count">${count}</span>
      <span class="revenue">$${revenue}K</span>
    </div>`;
  }).join('');
}

function selectLocation(loc) {
  selectedLocation = loc;
  renderLocationTabs();
  renderCrewPanel();
  renderStats();
  renderQueue();
  renderCalendar();
}

function renderStageTabs() {
  const container = document.getElementById('stageTabs');
  container.innerHTML = `
    <div class="stage-tab ${selectedStage === 'all' ? 'active' : ''}" onclick="selectStage('all')">All</div>
    <div class="stage-tab construction ${selectedStage === 'construction' ? 'active' : ''}" onclick="selectStage('construction')">üî® Construction</div>
    <div class="stage-tab rtb ${selectedStage === 'rtb' ? 'active' : ''}" onclick="selectStage('rtb')">‚úÖ RTB</div>
    <div class="stage-tab blocked ${selectedStage === 'blocked' ? 'active' : ''}" onclick="selectStage('blocked')">‚ö†Ô∏è Blocked</div>
  `;
}

function selectStage(stage) {
  selectedStage = stage;
  selectedProject = null;
  document.getElementById('instructions').classList.remove('visible');
  renderStageTabs();
  renderQueue();
}

function renderCrewPanel() {
  const container = document.getElementById('crewGrid');
  const loc = selectedLocation === 'All' ? null : selectedLocation;
  
  if (loc && crews[loc]) {
    container.innerHTML = crews[loc].map(c => `
      <div class="crew-card">
        <div class="crew-name">${c.name}</div>
        <div class="crew-members">
          ${c.roofers > 0 ? `<span class="crew-member roofer">${c.roofers} Roofers</span>` : ''}
          ${c.electricians > 0 ? `<span class="crew-member electrician">${c.electricians} Elec</span>` : ''}
        </div>
      </div>
    `).join('');
    document.getElementById('crewPanel').style.display = 'block';
  } else {
    container.innerHTML = '<div style="font-size:0.65rem;color:var(--text-dim);">Select a location to see crews</div>';
  }
}

function renderStats() {
  const container = document.getElementById('statsBar');
  const filteredProjects = selectedLocation === 'All' ? projects : projects.filter(p => p.location === selectedLocation);
  
  const constructionCount = filteredProjects.filter(p => p.stage === 'construction').length;
  const rtbCount = filteredProjects.filter(p => p.stage === 'rtb').length;
  const blockedCount = filteredProjects.filter(p => p.stage === 'blocked').length;
  const totalRevenue = (filteredProjects.reduce((sum, p) => sum + p.amount, 0) / 1000).toFixed(0);
  
  container.innerHTML = `
    <div class="stat">
      <div class="stat-dot" style="background: var(--construction);"></div>
      <div class="stat-value">${constructionCount}</div>
      <div class="stat-label">Construction</div>
    </div>
    <div class="stat">
      <div class="stat-dot" style="background: var(--rtb);"></div>
      <div class="stat-value">${rtbCount}</div>
      <div class="stat-label">RTB</div>
    </div>
    <div class="stat">
      <div class="stat-dot" style="background: var(--rtb-blocked);"></div>
      <div class="stat-value">${blockedCount}</div>
      <div class="stat-label">Blocked</div>
    </div>
    <div class="stat">
      <div class="stat-dot" style="background: var(--accent);"></div>
      <div class="stat-value">$${totalRevenue}K</div>
      <div class="stat-label">Pipeline</div>
    </div>
  `;
}

function renderLegend() {
  const container = document.getElementById('legend');
  container.innerHTML = `
    <div class="legend-item"><div class="legend-dot" style="background: var(--construction);"></div>Construction (Scheduled)</div>
    <div class="legend-item"><div class="legend-dot" style="background: var(--rtb);"></div>RTB Ready</div>
    <div class="legend-item"><div class="legend-dot" style="background: var(--rtb-blocked);"></div>RTB Blocked</div>
    <div class="legend-item"><div class="legend-dot" style="background: var(--solar);"></div>Newly Scheduled</div>
  `;
}

function formatShortDate(dateStr) {
  if (!dateStr) return '';
  const d = new Date(dateStr + 'T12:00:00');
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

function getFilteredProjects() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const typeFilter = document.getElementById('typeFilter').value;
  
  return projects.filter(p => {
    if (selectedLocation !== 'All' && p.location !== selectedLocation) return false;
    if (selectedStage !== 'all' && p.stage !== selectedStage) return false;
    if (search && !p.name.toLowerCase().includes(search) && !p.address.toLowerCase().includes(search)) return false;
    if (typeFilter && (!p.type || !p.type.includes(typeFilter))) return false;
    return true;
  }).sort((a, b) => b.amount - a.amount);
}

function renderQueue() {
  const queue = getFilteredProjects();
  const container = document.getElementById('queueList');
  const totalRevenue = (queue.reduce((sum, p) => sum + p.amount, 0) / 1000).toFixed(0);
  document.getElementById('queueCount').textContent = `${queue.length} projects ‚Ä¢ $${totalRevenue}K pipeline`;
  
  container.innerHTML = queue.map(p => {
    const customerName = p.name.split(' | ')[1] || p.name;
    const types = (p.type || '').split(';').filter(t => t.trim());
    const stageLabel = p.stage === 'construction' ? 'üî® Construction' : p.stage === 'rtb' ? '‚úÖ RTB' : '‚ö†Ô∏è Blocked';
    
    return `
      <div class="queue-item ${p.stage} ${selectedProject?.id === p.id ? 'selected' : ''}" onclick="selectProject('${p.id}')">
        <div class="queue-item-header">
          <div class="queue-item-name" title="${p.name}">${customerName}</div>
          <div class="queue-item-amount">$${(p.amount/1000).toFixed(1)}K</div>
        </div>
        <div class="queue-item-address" title="${p.address}">${p.address}</div>
        <div class="queue-item-meta">
          <span class="queue-item-tag ${p.stage}">${stageLabel}</span>
          ${p.scheduleDate ? `<span class="queue-item-tag scheduled-date">üìÖ ${formatShortDate(p.scheduleDate)}</span>` : ''}
          ${types.slice(0, 2).map(t => {
            const cls = t.toLowerCase().includes('solar') ? 'solar' : 
                       t.toLowerCase().includes('battery') ? 'battery' :
                       t.toLowerCase().includes('ev') ? 'ev' :
                       t.toLowerCase().includes('electrical') ? 'electrical' : '';
            return `<span class="queue-item-tag ${cls}">${t.trim()}</span>`;
          }).join('')}
        </div>
        <div class="queue-item-specs">
          ${p.systemSize ? `<span class="spec"><strong>${p.systemSize}</strong> kW</span>` : ''}
          ${p.batteries ? `<span class="spec"><strong>${p.batteries}</strong> batt</span>` : ''}
          ${p.daysInstall ? `<span class="spec"><strong>${p.daysInstall}</strong>d</span>` : ''}
          ${p.crew ? `<span class="spec">${p.crew}</span>` : ''}
        </div>
      </div>
    `;
  }).join('');
}

function selectProject(id) {
  selectedProject = projects.find(p => p.id === id);
  if (selectedProject.stage !== 'construction') {
    document.getElementById('instructions').classList.add('visible');
    const customerName = selectedProject.name.split(' | ')[1] || selectedProject.name;
    document.getElementById('selectedProjectName').textContent = customerName;
  } else {
    document.getElementById('instructions').classList.remove('visible');
  }
  renderQueue();
  renderCalendar();
}

function getCalendarEvents() {
  const events = [];
  
  // Add construction projects with schedule dates
  projects.forEach(p => {
    if (p.scheduleDate) {
      events.push({
        ...p,
        date: p.scheduleDate,
        eventType: 'construction',
        days: p.daysInstall || 2
      });
    }
  });
  
  // Add manual schedules
  Object.entries(manualSchedules).forEach(([id, data]) => {
    const project = projects.find(p => p.id === id);
    if (project && !project.scheduleDate) {
      events.push({
        ...project,
        date: data.startDate,
        eventType: 'scheduled',
        days: data.days
      });
    }
  });
  
  return events;
}

function renderCalendar() {
  const cal = document.getElementById('calendar');
  const firstDay = new Date(currentYear, currentMonth, 1);
  const lastDay = new Date(currentYear, currentMonth + 1, 0);
  const startDay = firstDay.getDay();
  const daysInMonth = lastDay.getDate();
  const today = new Date();
  
  let html = dayNames.map(d => `<div class="day-header">${d}</div>`).join('');
  
  const events = getCalendarEvents();
  const eventsByDate = {};
  
  events.forEach(e => {
    if (selectedLocation !== 'All' && e.location !== selectedLocation) return;
    
    const startDate = new Date(e.date);
    const days = e.days || 1;
    
    for (let i = 0; i < days; i++) {
      const eventDate = new Date(startDate);
      eventDate.setDate(eventDate.getDate() + i);
      
      if (eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear) {
        const day = eventDate.getDate();
        if (!eventsByDate[day]) eventsByDate[day] = [];
        eventsByDate[day].push({
          ...e,
          dayNum: i + 1,
          totalDays: days,
          isMultiDay: days > 1
        });
      }
    }
  });
  
  // Previous month
  const prevDays = new Date(currentYear, currentMonth, 0).getDate();
  for (let i = startDay - 1; i >= 0; i--) {
    html += `<div class="day other-month"><div class="day-number">${prevDays - i}</div></div>`;
  }
  
  // Current month
  for (let day = 1; day <= daysInMonth; day++) {
    const currentDate = new Date(currentYear, currentMonth, day);
    const isToday = today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear;
    const isWeekend = currentDate.getDay() === 0 || currentDate.getDay() === 6;
    const dayEvents = eventsByDate[day] || [];
    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const canSchedule = selectedProject && selectedProject.stage !== 'construction';
    
    html += `<div class="day${isToday ? ' today' : ''}${canSchedule ? ' drop-target' : ''}${isWeekend ? ' weekend' : ''}" onclick="handleDayClick('${dateStr}')">`;
    html += `<div class="day-number">${day}</div>`;
    
    dayEvents.slice(0, 3).forEach(e => {
      const shortName = e.name.split(' | ')[1]?.split(',')[0]?.substring(0, 10) || e.name.substring(0, 10);
      const dayIndicator = e.isMultiDay ? `D${e.dayNum}` : '';
      html += `<div class="event ${e.eventType}" onclick="event.stopPropagation();showDetail('${e.id}')" title="${e.name} - ${e.crew || 'No crew'}">${dayIndicator ? dayIndicator + ' ' : ''}${shortName}</div>`;
    });
    
    if (dayEvents.length > 3) {
      html += `<div class="more-events">+${dayEvents.length - 3}</div>`;
    }
    
    html += '</div>';
  }
  
  // Next month
  const total = startDay + daysInMonth;
  const rem = 7 - (total % 7);
  if (rem < 7) {
    for (let i = 1; i <= rem; i++) {
      html += `<div class="day other-month"><div class="day-number">${i}</div></div>`;
    }
  }
  
  cal.innerHTML = html;
  document.getElementById('monthTitle').textContent = `${monthNames[currentMonth]} ${currentYear}`;
}

function handleDayClick(dateStr) {
  if (!selectedProject || selectedProject.stage === 'construction') return;
  
  const customerName = selectedProject.name.split(' | ')[1] || selectedProject.name;
  const types = (selectedProject.type || 'Service').split(';').filter(t => t.trim()).join(', ');
  
  // Get crews for this location
  const locationCrews = crews[selectedProject.location] || [];
  const crewOptions = locationCrews.map(c => `<option value="${c.name}" ${c.name === selectedProject.crew ? 'selected' : ''}>${c.name}</option>`).join('');
  
  document.getElementById('modalBody').innerHTML = `
    <div class="modal-section">
      <div class="modal-section-title">Project Info</div>
      <div class="modal-row"><span class="modal-label">Customer</span><span>${customerName}</span></div>
      <div class="modal-row"><span class="modal-label">Address</span><span>${selectedProject.address}</span></div>
      <div class="modal-row"><span class="modal-label">Location</span><span>${selectedProject.location}</span></div>
      <div class="modal-row"><span class="modal-label">Type</span><span>${types}</span></div>
      <div class="modal-row"><span class="modal-label">Amount</span><span style="color:var(--accent);font-weight:600;">$${selectedProject.amount.toLocaleString()}</span></div>
      <div class="modal-row"><span class="modal-label">Status</span><span style="color:${selectedProject.stage === 'rtb' ? 'var(--rtb)' : 'var(--rtb-blocked)'}">${selectedProject.stage === 'rtb' ? '‚úÖ RTB Ready' : '‚ö†Ô∏è RTB Blocked'}</span></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">Equipment</div>
      ${selectedProject.systemSize ? `<div class="modal-row"><span class="modal-label">System Size</span><span>${selectedProject.systemSize} kW</span></div>` : ''}
      ${selectedProject.batteries ? `<div class="modal-row"><span class="modal-label">Batteries</span><span>${selectedProject.batteries}x ${selectedProject.batteryModel || 'Tesla'}</span></div>` : ''}
      ${selectedProject.roofType ? `<div class="modal-row"><span class="modal-label">Roof Type</span><span>${selectedProject.roofType}</span></div>` : ''}
    </div>
    <div class="modal-section">
      <div class="modal-section-title">Schedule Details</div>
      <div class="modal-row"><span class="modal-label">Start Date</span><span><strong>${formatDate(dateStr)}</strong></span></div>
      <div class="days-input">
        <label>Install Days:</label>
        <input type="number" id="installDays" value="${selectedProject.daysInstall || 2}" min="1" max="10">
        <label>Elec Days:</label>
        <input type="number" id="elecDays" value="${selectedProject.daysElec || 1}" min="1" max="5">
        <label>Crew:</label>
        <select id="crewSelect">${crewOptions || '<option>No crews</option>'}</select>
      </div>
    </div>
  `;
  
  document.getElementById('modalOverlay').classList.add('visible');
  window.pendingDate = dateStr;
}

function showDetail(id) {
  const p = projects.find(proj => proj.id === id);
  if (!p) return;
  
  const customerName = p.name.split(' | ')[1] || p.name;
  const types = (p.type || 'Service').split(';').filter(t => t.trim()).join(', ');
  const stageColor = p.stage === 'construction' ? 'var(--construction)' : p.stage === 'rtb' ? 'var(--rtb)' : 'var(--rtb-blocked)';
  const stageLabel = p.stage === 'construction' ? 'üî® In Construction' : p.stage === 'rtb' ? '‚úÖ RTB Ready' : '‚ö†Ô∏è RTB Blocked';
  
  document.getElementById('detailModalBody').innerHTML = `
    <div class="modal-section">
      <div class="modal-section-title">Project Info</div>
      <div class="modal-row"><span class="modal-label">Project ID</span><span>${p.name.split(' | ')[0]}</span></div>
      <div class="modal-row"><span class="modal-label">Customer</span><span>${customerName}</span></div>
      <div class="modal-row"><span class="modal-label">Address</span><span>${p.address}</span></div>
      <div class="modal-row"><span class="modal-label">Location</span><span>${p.location}</span></div>
      <div class="modal-row"><span class="modal-label">Type</span><span>${types}</span></div>
      <div class="modal-row"><span class="modal-label">Amount</span><span style="color:var(--accent);font-weight:600;">$${p.amount.toLocaleString()}</span></div>
      <div class="modal-row"><span class="modal-label">Status</span><span style="color:${stageColor}">${stageLabel}</span></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">Equipment</div>
      <div class="modal-row"><span class="modal-label">System Size</span><span>${p.systemSize ? p.systemSize + ' kW' : 'N/A'}</span></div>
      <div class="modal-row"><span class="modal-label">Batteries</span><span>${p.batteries ? `${p.batteries}x ${p.batteryModel || 'Tesla'}` : 'None'}</span></div>
      <div class="modal-row"><span class="modal-label">Roof Type</span><span>${p.roofType || 'N/A'}</span></div>
    </div>
    <div class="modal-section">
      <div class="modal-section-title">Schedule</div>
      <div class="modal-row"><span class="modal-label">Schedule Date</span><span style="color:var(--construction);font-weight:600;">${p.scheduleDate ? formatDate(p.scheduleDate) : 'Not scheduled'}</span></div>
      <div class="modal-row"><span class="modal-label">Install Days</span><span>${p.daysInstall || 2} days</span></div>
      <div class="modal-row"><span class="modal-label">Electrician Days</span><span>${p.daysElec || 1} days</span></div>
      <div class="modal-row"><span class="modal-label">Assigned Crew</span><span>${p.crew || 'Unassigned'}</span></div>
    </div>
  `;
  
  document.getElementById('hubspotLink').href = p.hubspotUrl;
  document.getElementById('detailModal').classList.add('visible');
}

function closeDetailModal() {
  document.getElementById('detailModal').classList.remove('visible');
}

function formatDate(dateStr) {
  const date = new Date(dateStr + 'T12:00:00');
  return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('visible');
  window.pendingDate = null;
}

function confirmSchedule() {
  if (!selectedProject || !window.pendingDate) return;
  
  const days = parseInt(document.getElementById('installDays').value) || 2;
  const crew = document.getElementById('crewSelect')?.value || null;
  
  manualSchedules[selectedProject.id] = {
    startDate: window.pendingDate,
    days: days,
    crew: crew
  };
  
  const customerName = selectedProject.name.split(' | ')[1] || selectedProject.name;
  showToast(`‚úì ${customerName} scheduled for ${formatDate(window.pendingDate)} (${days} days)`);
  
  closeModal();
  selectedProject = null;
  document.getElementById('instructions').classList.remove('visible');
  
  renderQueue();
  renderCalendar();
}

function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('visible');
  setTimeout(() => toast.classList.remove('visible'), 3000);
}

function prevMonth() {
  currentMonth--;
  if (currentMonth < 0) { currentMonth = 11; currentYear--; }
  renderCalendar();
}

function nextMonth() {
  currentMonth++;
  if (currentMonth > 11) { currentMonth = 0; currentYear++; }
  renderCalendar();
}

// Event listeners
document.getElementById('searchInput').addEventListener('input', renderQueue);
document.getElementById('typeFilter').addEventListener('change', renderQueue);

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    if (document.getElementById('modalOverlay').classList.contains('visible')) {
      closeModal();
    } else if (document.getElementById('detailModal').classList.contains('visible')) {
      closeDetailModal();
    } else if (selectedProject) {
      selectedProject = null;
      document.getElementById('instructions').classList.remove('visible');
      renderQueue();
    }
  }

  // Navigation
  if (e.altKey && e.key === 'ArrowLeft') prevMonth();
  if (e.altKey && e.key === 'ArrowRight') nextMonth();
});

// Click outside modal to close
document.getElementById('modalOverlay').addEventListener('click', (e) => {
  if (e.target.id === 'modalOverlay') closeModal();
});
document.getElementById('detailModal').addEventListener('click', (e) => {
  if (e.target.id === 'detailModal') closeDetailModal();
});

// Initialize with error handling
try {
  init();
  console.log('PB Install Scheduler initialized successfully');
  console.log('Keyboard: Escape=close, Alt+Arrow=navigate months');
} catch (e) {
  console.error('Failed to initialize scheduler:', e);
  document.body.innerHTML = `
    <div style="padding: 2rem; text-align: center; color: #ef4444; font-family: sans-serif;">
      <h2>Failed to Load Scheduler</h2>
      <p style="margin-top: 1rem;">Please refresh the page.</p>
    </div>
  `;
}
</script>
</body>
</html>
